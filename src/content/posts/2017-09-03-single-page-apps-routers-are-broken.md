---
layout: post
title: 'Single Page Apps routers are broken'
date: 2017-09-03
excerpt: ' Currently, every major Single Page App’s (SPA) router is broken the second you install it (Ember, Angular, React/Preact/Vue.js, etc). Before we go much further, I want to make sure you know I’m not hating on SPAs. The opp...'
---

 <p>Currently, every major Single Page App’s (SPA) router is broken the second you install it (Ember, Angular, React/Preact/Vue.js, etc). Before we go much further, I want to make sure you know I’m not hating on SPAs. The opposite, actually! I love SPAs and the benefits that come with them are amazing.</p><p>Those benefits come with tradeoffs. For example, with SPAs, you don’t have to re-render the entire page when you navigate to a new route. Only the part of the page that has changed will re-render. This has great performance benefits but leaves a gaping hole for users who rely on assistive technology like a screen reader.</p><p>When you click a link on a server rendered page it will re-render the entire page. This works great with screen readers because they know there’s a new page and they know when it has finished loading. Since SPAs don’t reload the page, screen readers don’t know new content has been loaded. This short video will get the point across:</p><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FNKTdNv8JpuM%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DNKTdNv8JpuM&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FNKTdNv8JpuM%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" width="854" height="480" frameborder="0" scrolling="no"><a href="https://medium.com/media/de8f6b4143306626e751dc823ca799fb/href">https://medium.com/media/de8f6b4143306626e751dc823ca799fb/href</a></iframe><p>In the video, I’m trying to navigate the disqus admin panel with VoiceOver (the macOS screen reader). You can <em>see</em> the route changes when I activate the “community” link but <em>nothing</em> is announced to the screen reader other than that you pressed a button. If you’re relying solely on what the screen reader is telling you, you have no clue that the link actually did its job.</p><p>This is what is broken about all current single page apps <em>out of the box</em>.</p><h3>Plugging the hole</h3><p>Thankfully most of the SPA frameworks and libraries provide a way to fill in this router gap. There are two different ways you could try and address this problem. Once the route has loaded either, announce the new page title to the screen reader <strong>or </strong>set focus on the new content once it has rendered.</p><p>Here are some examples on fixing the router in their respective framework / library:</p><h4>React (react-router)</h4><p>If you’re using React Router, you can set focus on new content by wrapping the Route component and utilizing componentDidMount:</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/6712bee84888e5d3e95e64fd8f139740/href">https://medium.com/media/6712bee84888e5d3e95e64fd8f139740/href</a></iframe><h4>Ember</h4><p>In Ember, it’s <em>really</em> easy to plug the gap. As with everything in the Ember community, there’s an addon that takes care of this for you! <a href="https://github.com/ember-a11y/ember-a11y">ember-a11y</a> will focus the newly rendered content for you. To install the addon you need to do two things:</p><ul><li>ember install ember-a11y</li><li>Change {{outlet}} in your templates to {{focusing-outlet}}</li></ul><p>That’s it!</p><h4>Angular</h4><p>In Angular (who arguably has the best a11y support, thanks <a href="https://twitter.com/marcysutton">Marcy</a>!!), you can install the <a href="https://github.com/dequelabs/ngA11y#accessible-announcement-service">ngA11y</a> package which provides two ways to fill the router gap:</p><ul><li><a href="https://github.com/dequelabs/ngA11y#accessibility-focus-management-directive">Using the </a><a href="https://github.com/dequelabs/ngA11y#accessibility-focus-management-directive">nga11y-focus directive</a> on the newly rendered content</li><li><a href="https://github.com/dequelabs/ngA11y#accessible-announcement-service">Announcing the new page title with the announcement service</a></li></ul><p>I recommend checking out the ngA11y package documentation for all of the neat a11y related helpers it provides.</p><h4>Vue</h4><p>Vue is one of the libraries that doesn’t seem to have a solution that exists in the community. I could be wrong! But from my googling around I can’t find anything that will be easy for you to drop in.</p><p>I decided to provide a naive example for announcing a named route in the VueRouter:</p><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fjsfiddle.net%2Frobdel12%2Fj7925xbw%2Fembedded%2F&amp;url=https%3A%2F%2Fjsfiddle.net%2Frobdel12%2Fj7925xbw%2F&amp;image=https%3A%2F%2Fwww.gravatar.com%2Favatar%2F43125456400e1456630c875bfcd2bc5e%2F%3Fdefault%3D%26s%3D80&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=jsfiddle" width="600" height="400" frameborder="0" scrolling="no"><a href="https://medium.com/media/a704fbd5551c439a859e53b5822faff8/href">https://medium.com/media/a704fbd5551c439a859e53b5822faff8/href</a></iframe><p>We name our routes ({ ... <em>name: &#39;Foo Page&#39;</em> }) and use VueRouter’s afterEach callback to announce that the new page has loaded:</p><pre>router.afterEach((to) =&gt; { <br>  if (!to.name) { return }<br>  announcer.innerHTML = `${to.name} has loaded`;<br>});</pre><p>Of course, this is a <em>really</em> contrived example. Hopefully, you won’t be setting the innerHTML of an element in your apps!</p><h3>Why isn’t this done by default?</h3><p>Seeing how it’s mostly pretty easy to plug this gap it begs the question: why isn’t this done from the start? I’m sure there are valid reasons as to why this isn’t solved out of the box, but I want to hear from the library / framework authors.</p><p>Usually developers working within these frameworks aren’t aware that this is a problem, which is okay! But this means that almost all single page apps go to production with this bug.</p><p>I’m not here to place blame or shame! My ultimate goal is to work with everyone to solve this problem from the start. Developers shouldn’t have to worry about this kind of thing — they should be building their application. I want to see what <em>we can do </em>as a community to help fix this issue that currently plagues single page apps.</p><p>Lets open this discussion up!</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=255daa310cf" width="1" height="1" alt="">
