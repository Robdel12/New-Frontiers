---
layout: post
title: "Your tests arenâ€™t slow because of Karma (or the browser)"
date: 2019-06-21 04:28:56 UTC
excerpt: " Thereâ€™s been a trend I have been seeing around the front end world where folks are switching their test suites to use Jest over something like Karma and Mocha. Usually the main benefit thatâ€™s touted is speed&nbsp;ğŸğŸ’¨  What..."
---

 <p>Thereâ€™s been a trend I have been seeing around the front end world where folks are switching their test suites to use Jest over something like Karma and Mocha. Usually the main benefit thatâ€™s touted is speedÂ ğŸğŸ’¨</p><p>Whatâ€™s not commonly talked about is the the trade-off youâ€™re making hereâ€Šâ€”â€Šyouâ€™re no longer testing in an environment any users actually use. You canâ€™t test in Safari, Chrome, Edge, or Firefox anymore. Youâ€™re running your tests in JSDOM, which is an implementation of the DOM spec. I donâ€™t see this being any better than something like PhantomJS (RIP in peace). Cross browser bugs exist, and the DOM is not just an implementation detail.</p><p>Donâ€™t get me wrong, Jest is a <em>really</em> nice test runner. Thereâ€™s a whole lot to love about it. Which is why I have a vested interest in getting it to run inside of a real browser. But the speed boost you get from running your tests in the JSDOM is not worth the trade-off youâ€™re making,Â imo.</p><h3>Best of bothÂ worlds</h3><p>Itâ€™s totally possible to have <em>blazing</em> fast component unit tests that fully mount into the DOM inside of a real browser. How fast? How about <strong>661 tests that complete in 17 seconds</strong>? <a href="https://jenkins-aws.indexdata.com/blue/organizations/jenkins/folio-org%2Fstripes-components/detail/master/815/pipeline/67/">Hereâ€™s your proof</a>. With compiling everything and launching the browser the total time is <strong>51 seconds</strong>. <a href="https://github.com/folio-org/stripes-components">Hereâ€™s the source of the repo</a> that those tests are comingÂ from.</p><h4>How?</h4><p>Karma isnâ€™t slow. The real DOM isnâ€™t slow as you think it is. Itâ€™s probably the tools you picked to help write those tests. The example I mentioned above that runs so fast uses a package called <a href="https://interactorjs.io">Interactor.js</a>. Interactor.js is a composable, immutable, asynchronous way to interact with components or applications like a user would. From the introduction in theÂ docs:</p><blockquote>Interactors work anywhere there is DOM, and run alongside your tests to produce blazingly fast results. They automatically wait for elements to exist in the DOM before interacting with them and also provide a simple interface for making asynchronous assertions against the DOM asÂ well.</blockquote><p>Not only are those tests extremely fast with Interactor.js, it carries many benefits with no trade offs like JSDOM does (and is <em>faster</em>). Youâ€™re testing in real browser<strong>s</strong> while actually interacting with the DOM like a user would in realÂ life.</p><p>Combine Interactor.js with something like <a href="https://github.com/wwilsman/testing-hooks">testing-hooks</a> or <a href="https://github.com/testing-library/dom-testing-library">dom-testing-library</a> to mount the components into the DOM and you have a seriously powerful combo! Imagine this example that completes in less than aÂ second:</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/ad7de3959f25b90eced8b01e5560c815/href">https://medium.com/media/ad7de3959f25b90eced8b01e5560c815/href</a></iframe><p>This is only scratching the surface of the possibilities that Interactor.js unlocks. I think it would be worth taking a look before moving your tests over to Jest (orÂ JSDOM).</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=dd4347296991" width="1" height="1" alt="">