---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

let posts = await getCollection('posts');
posts = posts.sort((a, b) => new Date(b.data.date) - new Date(a.data.date));
---

<BaseLayout title="Blog">
  <div class="blog-list">
    <h1>Blog Posts</h1>
    <ul class="post-list">
      {posts.map((post) => {
        let date = new Date(post.data.date);
        let year = date.getFullYear();
        let month = String(date.getMonth() + 1).padStart(2, '0');
        let day = String(date.getDate()).padStart(2, '0');
        let url = `/${year}/${month}/${day}/${post.slug}`;
        
        return (
          <li>
            <span class="post-meta">
              {date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
              })}
            </span>
            <h3>
              <a class="post-link" href={url}>
                {post.data.title}
              </a>
            </h3>
            {post.data.excerpt && <p class="post-excerpt">{post.data.excerpt}</p>}
          </li>
        );
      })}
    </ul>
  </div>
</BaseLayout>