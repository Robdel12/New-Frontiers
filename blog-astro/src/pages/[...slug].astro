---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  let posts = await getCollection('posts');
  
  return posts.map((post) => {
    let date = new Date(post.data.date);
    let year = date.getFullYear();
    let month = String(date.getMonth() + 1).padStart(2, '0');
    let day = String(date.getDate()).padStart(2, '0');
    
    return {
      params: { 
        slug: `${year}/${month}/${day}/${post.slug}` 
      },
      props: { 
        post 
      }
    };
  });
}

let { post } = Astro.props;
let { Content } = await post.render();
---

<BaseLayout 
  title={post.data.title} 
  description={post.data.excerpt || post.data.title}
  type="article"
  image="/assets/images/robert-deluca-bio-portrait.jpg"
>
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">{post.data.title}</h1>
      <p class="post-meta">
        <time datetime={post.data.date.toISOString()}>
          {post.data.date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          })}
        </time>
      </p>
    </header>
    
    <div class="post-content">
      <Content />
    </div>
  </article>
</BaseLayout>